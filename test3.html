<!DOCTYPE html>
<html>
<head>
	<title>Test</title>
	<style type="text/css">
		body {
			background-color: black;
			color: white;
		}
	</style>
</head>
<body>
<div id="result">
</div>
<script type="text/javascript">
	function wH(val){
		let div = document.getElementById('result');
		 div.innerHTML =  div.innerHTML.toString() +'<br />' + val;
	}
	function pt(val){
		console.log(val);
		wH(val);
	}
</script>

<script type="text/javascript">
function countPeaks(arr) {
	let peaks = 0;
	arr.push(0);
	arr.unshift(0);
	console.log(arr);
	let equals = 0;
	let equalsFI = null;
	for (let i = 1; i < arr.length - 1; i++) {
		if(arr[i] > arr[i + 1] && arr[i] >= arr[i - 1]) {
			if(!equalsFI || arr[i] >= arr[equalsFI - 1]) equals = 0;
			peaks = peaks + 1 + equals;
			equals = 0;
			equalsFI = 0;
		} else if (arr[i] == arr[i+1]) {
			equals += 1;
			if(!equalsFI) equalsFI = i;
		} else {
			equals = 0;
			equalsFI = null;
		}
	}
	return peaks;
}
pt(countPeaks([1, 2, 2, 3, 4, 3, 5, 3, 2, 1, 2, 3, 3, 3, 2, 2, 1, 3]));
</script>
</body>
</html>